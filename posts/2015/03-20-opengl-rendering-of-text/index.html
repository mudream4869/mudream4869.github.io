<!doctype html><html lang=zh-tw><head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-100004441-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在OpenGL繪製中文字 &#183; Imaginary City</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/custom.css><link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title="Imaginary City"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>Imaginary City</h2></a><ul><li><a href=/about/><span>About</span></a></li><li><a href=/notes/><span>Notes</span></a></li><li><a href=/oj/><span>OJ</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li></ul></div></nav><main><div class=post><div class=post-info><br><time datetime="2015-03-20 08:00:00 +0000 UTC">March 20, 2015</time></div><h1 class=post-title>在OpenGL繪製中文字</h1><p style=text-align:center><a href=/tags/OpenGL>#OpenGL</a></p><div class=post-line></div><p>在OpenGL裏畫中文字一直是個蛋疼的問題，之前有找過一些Library像是<a href=https://github.com/rougier/freetype-gl>Freetype GL</a>，但對我的需求來說算滿大的，所以打算自己刻一個小的。</p><h2 id=freetype-project>Freetype-Project</h2><p>在 <strong>Freetype GL</strong> 也有用到這個，因為要畫字，就需要字形的讀取。</p><p><a href=http://www.freetype.org/freetype2/docs/documentation.html>Documentation</a></p><p>在Freetype project裡面主要有兩種東西：<code>FT_Library</code> 和 <code>FT_Face</code>，<code>FT_Library</code> 負責把管理字形資料，<code>FT_Face</code>負責儲存某個字形的BMP資料。</p><h3 id=ft_library-的初始化>FT_Library 的初始化</h3><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>FT_Libraray ft_lib;
</span></span><span style=display:flex><span>FT_Init_FreeType(ft_lib);
</span></span></code></pre></td></tr></table></div></div><h3 id=設定字形>設定字形</h3><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>FT_Face face;
</span></span><span style=display:flex><span>FT_New_Face(ft_lib, font_path, <span style=color:#b452cd>0</span>, face);
</span></span><span style=display:flex><span>FT_Set_Char_Size(face, <span style=color:#b452cd>0</span>, <span style=color:#b452cd>60</span> &lt;&lt; <span style=color:#b452cd>6</span>, <span style=color:#b452cd>96</span>, <span style=color:#b452cd>96</span>);
</span></span></code></pre></td></tr></table></div></div><h3 id=畫字>畫字</h3><p>因為要支援中文字，所以需要 <code>wchar_t</code></p><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7>7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8>8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9>9</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8b008b;font-weight:700>const</span> <span style=color:#00688b;font-weight:700>wchar_t</span> wstr[<span style=color:#b452cd>20</span>] = <span style=color:#cd5555>L</span><span style=color:#cd5555>&#34;你我他&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#00688b;font-weight:700>int</span> pen_x = <span style=color:#b452cd>300</span>, pen_y = <span style=color:#b452cd>200</span>;
</span></span><span style=display:flex><span>FT_GlyphSlot  slot = face-&gt;glyph;  <span style=color:#228b22>/* a small shortcut */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>for</span>(<span style=color:#00688b;font-weight:700>int</span> lx = <span style=color:#b452cd>0</span>;wstr[lx] != <span style=color:#b452cd>0</span>; lx++ ){
</span></span><span style=display:flex><span>	FT_Load_Char(face, (<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>char</span>)wstr[lx], FT_LOAD_RENDER );
</span></span><span style=display:flex><span>	<span style=color:#228b22>// draw slot-&gt;bitmap at (pen_x + slot-&gt;bitmap_left, pen_y - slot-&gt;bitmap_top);
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>	pen_x += slot-&gt;advance.x &gt;&gt; <span style=color:#b452cd>6</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=slot-bitmap>slot->bitmap</h3><p><code>slot->bitmap</code>本身是<a href=http://www.freetype.org/freetype2/docs/reference/ft2-basic_types.html#FT_Bitmap>FT_Bitmap</a>的結構</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8b008b;font-weight:700>typedef</span> <span style=color:#8b008b;font-weight:700>struct</span>  <span style=color:#008b45;font-weight:700>FT_Bitmap_</span>{
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>int</span>    rows;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>int</span>    width;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>int</span>             pitch;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>char</span>*  buffer;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>short</span>  num_grays;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>char</span>   pixel_mode;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>unsigned</span> <span style=color:#00688b;font-weight:700>char</span>   palette_mode;
</span></span><span style=display:flex><span>	<span style=color:#00688b;font-weight:700>void</span>*           palette;
</span></span><span style=display:flex><span>} FT_Bitmap;
</span></span></code></pre></td></tr></table></div></div><p>需要的資料是<code>buffer</code>、<code>width</code>、<code>rows</code>，分別是bitmap pixel資料、寬和高</p><p>最後弄成這樣的一個小工具：<a href=https://github.com/mudream4869/min-ftgl>minftgl</a></p><hr><script src=https://utteranc.es/client.js repo=mudream4869/imgcity-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></div><div class=pagination><a href=/posts/2015/03-08-note-15-puzzle/ class="left arrow">&#8592;15-puzzle</a>
<a href=/posts/2015/05-24-acm-codeforce-542-d-superheros-job/ class="right arrow">Codeforce 542 D. Superhero's Job&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2022-06-16 10:32:07.134195546 +0000 UTC m=+0.165330269">2022</time> Mudream. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>
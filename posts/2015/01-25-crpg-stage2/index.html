<!doctype html><html lang=zh-tw><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-05CDSVM4JL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-05CDSVM4JL",{anonymize_ip:!1})}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>CRPG 第二階段完成 &#183; Imaginary City</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/custom.css><link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title="Imaginary City"></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>Imaginary City</h2></a><ul><li><a href=/about/><span>About</span></a></li><li><a href=https://blog.mukyu.tw/note-of-code/><span>Notes</span></a></li><li><a href=/oj/><span>OJ</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li></ul></div></nav><main><div class=post><div class=post-info><br><time datetime="2015-01-25 08:00:00 +0000 UTC">January 25, 2015</time></div><h1 class=post-title>CRPG 第二階段完成</h1><p style=text-align:center><a href=/tags/RPG>#RPG</a>
<a href=/tags/C++>#C++</a></p><div class=post-line></div><p>第二階段主要是把功能補到可以讓一個小小的遊戲運行。終於告一段落了（癱</p><p>文件神馬的就先等最後階段吧（滾（被揍</p><h2 id=小小的遊戲>小小的遊戲</h2><p>目前只能在mac上編譯。</p><p>玩具當然先拿出來，不過這版本是<strong>Unstable</strong>的，修改著玩是可以的，不過可別認真修改這貨，要執行的話要<code>cd</code>到該資料夾，然後<code>$ ./lock</code></p><p><a href=https://www.mediafire.com/folder/i9a4ved645ovi/Lock>Game : Lock</a></p><p><img src=preview.png alt=preview.png></p><h2 id=過程>過程</h2><p>在第二階段，碰到了一些有趣的事情，值得記錄一下</p><h3 id=openal>OpenAL</h3><p>遊戲怎麼能缺少聲音呢，有OpenGL怎能沒有OpenAL呢(笑</p><p>OpenAL 簡易教學</p><h3 id=python-api-interpreter-not-thread-safe>Python API Interpreter not thread safe</h3><p>老實說，一開始在code時沒注意到，在第二階段才發現，最後，我用<code>std::mutex</code>和Python提供操縱多Interpreter的API解決了，主要是用mutex使得當前Interpreter只有一個事件在做，當這個事件進入IO waiting時，把狀態存下，Lock釋出，等重新獲得Lock時，再把狀態塞回去。</p><ul><li><a href=http://en.cppreference.com/w/cpp/thread/mutex>std::mutex</a></li><li><a href=https://docs.python.org/2/c-api/init.html>Initialization, Finalization, and Threads</a></li></ul><h2 id=png-loader>PNG Loader</h2><p>找到了一個不錯的c++ PNG Loader:</p><ul><li><a href=http://lodev.org/lodepng/>LodePNG</a></li></ul><h3 id=把scene從env裡面移除>把scene從env裡面移除</h3><p>一直覺得env實在有點髒，裡面有各種東西。</p><p>於是之後我在Scene class裡面改了：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8b008b;font-weight:700>class</span> <span style=color:#008b45;font-weight:700>Scene</span>{
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>public</span>:
</span></span><span style=display:flex><span>    <span style=color:#228b22>//...
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>    <span style=color:#8b008b;font-weight:700>static</span> Scene* scene_now;
</span></span><span style=display:flex><span>    <span style=color:#228b22>//...
</span></span></span><span style=display:flex><span><span style=color:#228b22></span>};
</span></span></code></pre></td></tr></table></div></div><p>其他的Scene子類型也增個instance，這樣增修後，更改scene的code簡潔許多。</p><h3 id=windowblocktype>WindowBlockType</h3><p>我把會占用Input的Window另外分了一類，並且把資源控制權交給各個instance，這樣合理多了。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8b008b;font-weight:700>class</span> <span style=color:#008b45;font-weight:700>WindowBlockType</span>{
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>public</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>static</span> WindowBlockType* msg;
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>在instance裡面要結束時，直接：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>WindowBlockType::msg = <span style=color:#8b008b;font-weight:700>nullptr</span>;
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>delete</span> <span style=color:#8b008b;font-weight:700>this</span>;
</span></span></code></pre></td></tr></table></div></div><h2 id=第二階段沒解決的>第二階段沒解決的</h2><p><a href=https://github.com/mudream4869/crpg/issues>crpg : Issues</a></p><h3 id=跨到windows>跨到Windows</h3><p>下一階段會完成的！crpg最初的希望． :)</p><h3 id=良好的資源控制>良好的資源控制</h3><h3 id=很多instance可能不thread-safe>很多Instance可能不<strong>Thread Safe</strong></h3><h3 id=紅線問題>紅線問題</h3><p>很想知道到底是怎麼回事＠＠</p><h3 id=opengl中文字>OpenGL中文字</h3><p>這一直是一個麻煩的東西，我暫時不會把他列在<strong>crpg1.0</strong>的目標裡面。</p><h3 id=事件當前狀態取得和設定>事件當前狀態取得和設定</h3><p>總覺的這恐怕無法以正常手段達成。</p><hr><script src=https://utteranc.es/client.js repo=mudream4869/imgcity-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></div><div class=pagination><a href=/posts/2015/01-19-dynamic-access-k-th/ class="left arrow">&#8592;動態存取第k大</a>
<a href=/posts/2015/02-17-crpg-progress-note/ class="right arrow">CRPG 進度筆記&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2023-08-06 06:40:04.398766537 +0000 UTC m=+0.174635618">2023</time> Mudream. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>
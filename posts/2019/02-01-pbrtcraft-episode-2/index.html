<!doctype html><html lang=zh-tw><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-05CDSVM4JL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-05CDSVM4JL")}</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>PbrtCraft 進度二 &#183; Imaginary City</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/custom.css><link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title="Imaginary City"></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>Imaginary City</h2></a><ul><li><a href=/about/><span>About</span></a></li><li><a href=https://blog.mukyu.tw/note-of-code/><span>Notes</span></a></li><li><a href=/oj/><span>OJ</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li></ul></div></nav><main><div class=post><div class=post-info><br><time datetime="2019-02-01 08:00:00 +0000 UTC">February 1, 2019</time></div><h1 class=post-title>PbrtCraft 進度二</h1><p style=text-align:center><a href=/tags/rendering>#Rendering</a>
<a href=/tags/python>#Python</a>
<a href=/tags/pbrtcraft>#Pbrtcraft</a></p><div class=post-line></div><p><a href=/blog/2019-01-12/pbrtcraft-episode-1/>點我到上一次進度</a></p><p>這一次進度包含物理、讀檔還有一些讓 Code 更好維護。</p><h2 id=pbrt-v3>Pbrt-v3</h2><p>我直接把之前的東西移到 pbrt-v3 了。好處不少，至少 OpenEXR 的版本比 pbrt-v2 的新了，也有 Stochastic Progressive Photon Mapping 。</p><h2 id=物理>物理</h2><h3 id=水>水</h3><p>這次的進度並沒有去模擬流體，只有做一點針對高度的一點平滑化的處理，還有物理性質的設定。</p><p>一個水塊會用一個 3x3 的 HeightField 表示，中間的高度是這方格水本身的高度，旁邊八個則是和旁邊的方塊做內差。</p><p><img src=water-heightfield.png alt></p><p>物理性質則是把折射率調成 1.33 ，穿透光譜則設成偏藍色。</p><p>Pbrt-v3 部分，我只把原本 Heightfield 吃的 Z 軸改成 Y 軸。</p><h3 id=發光體>發光體</h3><p>直接把 Texture 當作一種光源。這裡一點小細節是我把火把的亮度抬高 8 倍，因為火把的表面積比一班方塊小很多。</p><p>由於 Pbrt-v3 的 diffuse area light 只提供純色發光面，所以我根據 <code>diffuse.cpp</code> 改寫出一個 <a href=https://github.com/PbrtCraft/pbrt-v3-minecraft/blob/master/src/lights/texlight.cpp>texlight.cpp</a> 。</p><h3 id=biome>Biome</h3><p>Minecraft 的生態域顏色是寫死的，可以直接參照 <a href=https://github.com/erich666/Mineways/blob/master/Win/biomes.cpp>Mineway/biomes.cpp</a> 改寫。</p><h3 id=result>Result</h3><p><img src=demo1.png alt></p><h2 id=讀取>讀取</h2><h3 id=玩家>玩家</h3><p>主要是要自動讀取玩家當前的位置還有眼睛方向，設定檔裡面會提供座標還有眼睛的經緯度，很容易就可以轉換成 Pbrt 吃的 Lookat Vector 。</p><p>看的方向可以直接用經緯度轉球座標，而頭頂向量則是用緯度+90度來算。</p><h3 id=資源>資源</h3><p>自動找到 minecraft 的 jar 檔，然後把資源解壓縮出來。 Python 這方面還真是方便，向自動把使用者的環境參數，建立暫存檔等 &mldr;</p><h2 id=整理>整理</h2><p>因為算是一個進度了，所以我打算整理一下整個專案。畢竟之前都是以目的為主，結果漂亮就可以接受。但假如繼續開發下去，整個程式碼只會越來越亂。</p><h3 id=pylint>Pylint</h3><p>這個程式可以指出 python script 哪些地方有問題，例如：</p><ul><li>多出的空白</li><li>逗號後面有沒有空格</li><li>Class, Function 有沒有 docstring</li></ul><p>等，然後還會給出一個評分。</p><h3 id=python-structure>Python Structure</h3><p>參考<a href=https://github.com/realpython/python-guide/blob/master/docs/writing/structure.rst>這篇</a>對專案的檔案結構做出一些改變。</p><h3 id=材質>材質</h3><p>我把材質的部分獨立出來成為一些 Class 。主要好處之後比較容易增加指定材質。</p><p>例如玻璃，只要之後在使用時呼叫 <code>write</code> ，便可以指定玻璃材質。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6>6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7>7</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b008b;font-weight:700>class</span> <span style=color:#008b45;font-weight:700>Glass</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>def</span> __init__(self, block):
</span></span><span style=display:flex><span>        self.block = block
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>def</span> <span style=color:#008b45>write</span>(self, fout, face):
</span></span><span style=display:flex><span>        tex = face[<span style=color:#cd5555>&#34;texture&#34;</span>]
</span></span><span style=display:flex><span>        fout.write(<span style=color:#cd5555>&#39;Material &#34;glass&#34; &#34;texture Kr&#34; &#34;</span><span style=color:#cd5555>%s</span><span style=color:#cd5555>-color&#34;</span><span style=color:#cd5555>\n</span><span style=color:#cd5555>&#39;</span> % tex)
</span></span></code></pre></td></tr></table></div></div><hr><script src=https://utteranc.es/client.js repo=mudream4869/imgcity-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></div><div class=pagination><a href=/posts/2019/01-31-master-second-winter/ class="left arrow">&#8592;碩二上總結
</a><a href=/posts/2019/07-23-master-second-spring/ class="right arrow">碩二下回顧&#8594;
</a><a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2024-06-30 15:18:19.53785406 +0000 UTC m=+0.338301302">2024</time> . Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>